# Comments Service Test Task

**ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°:**  
ĞœĞ¸ĞºÑ€Ğ¾ÑĞµÑ€Ğ²Ğ¸Ñ Ğ½Ğ° Go Ğ´Ğ»Ñ Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ Ğ¸ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸ Ğ¿Ğ¾ÑÑ‚Ğ¾Ğ² Ğ¸ ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸ĞµĞ² Ñ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸ĞµĞ¼ GraphQL.  
Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ĞµÑ‚ Ğ´Ñ€ĞµĞ²Ğ¾Ğ²Ğ¸Ğ´Ğ½ÑƒÑ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ñƒ ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸ĞµĞ² (Ğ²Ğ»Ğ¾Ğ¶ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ Ğ±ĞµĞ· Ğ¾Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ¸Ğ¹) Ğ¸ Ğ¿Ğ°Ğ³Ğ¸Ğ½Ğ°Ñ†Ğ¸Ñ.  
Ğ°Ğ½Ğ°Ğ»Ğ¾Ğ³Ğ¸Ñ‡Ğ½Ğ¾ Ñ‚Ğ°ĞºĞ¸Ğ¼ Ğ¿Ğ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼Ğ°Ğ¼ ĞºĞ°Ğº Ğ¥Ğ°Ğ±Ñ€ Ğ¸ Reddit.

---

## ĞÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ¹ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¾Ğ½Ğ°Ğ»

- ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ ÑĞ¿Ğ¸ÑĞºĞ° Ğ¿Ğ¾ÑÑ‚Ğ¾Ğ².
- ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ Ğ¾Ğ´Ğ½Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾ÑÑ‚Ğ° Ñ ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸ÑĞ¼Ğ¸.
- Ğ’Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚ÑŒ Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ¾Ğ¼ Ğ·Ğ°Ğ¿Ñ€ĞµÑ‚Ğ¸Ñ‚ÑŒ ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸Ğ¸ Ğº ÑĞ²Ğ¾ĞµĞ¼Ñƒ Ğ¿Ğ¾ÑÑ‚Ñƒ.
- ĞšĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸Ğ¸ Ğ±ĞµĞ· Ğ¾Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ¸Ñ Ğ¿Ğ¾ ÑƒÑ€Ğ¾Ğ²Ğ½Ñ Ğ²Ğ»Ğ¾Ğ¶ĞµĞ½Ğ½Ğ¾ÑÑ‚Ğ¸.
- ĞŸĞ°Ğ³Ğ¸Ğ½Ğ°Ñ†Ğ¸Ñ Ğ´Ğ»Ñ ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸ĞµĞ².
- ĞŸĞ°Ğ³Ğ¸Ğ½Ğ°Ñ†Ğ¸Ñ Ğ´Ğ»Ñ ÑÑ‚Ğ°Ñ‚ĞµĞ¹.

---

## ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ

ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ° Ğ·Ğ°Ğ´Ğ°ÑÑ‚ÑÑ Ñ‡ĞµÑ€ĞµĞ· `config.yaml`
ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸ Ğ´Ğ»Ñ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ° Ñ PostgreSQL:

```yaml
server:
  host: localhost
  port: 8888
  env: local

repository-mode: postgres

postgres:
  user: postgres
  password: postgres
  name: mydb
  port: 5432
  host: postgres # Ğ¸Ğ¼Ñ ĞºĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€Ğ° PostgreSQL
  migrate: true
  sslmode: disable
```

Ğ´Ğ»Ñ in-memory 
```yaml
server:
  host: localhost
  port: 8888
  env: local

repository-mode: in-memory
```

## Ğ—Ğ°Ğ¿ÑƒÑĞº

```bash
docker build -t comments-service-test-task .
```

Ğ´Ğ»Ñ in-memory
```bash
docker run -p 8888:8888 comments-service-test-task:latest
```

Ğ´Ğ»Ñ ĞºĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€Ğ° PostgreSQL
```bash
docker network create comments-network

docker run -d   --name postgres   --network comment-network   -p 5432:5432   -e POSTGRES_USER=postgres   -e POSTGRES_PASSWORD=postgres   -e POSTGRES_DB=mydb   postgres:latest

docker run -d   --name comments-service   --network comment-network   -p 8888:8888   comments-service-test-task:latest
```

## GraphQL API

### Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ ÑÑ‚Ğ°Ñ‚ÑŒÑ
```yaml
mutation {
  createArticle(input: {
    content: "Ñ‚ĞµÑÑ‚1",
    commentPermission: true
  }) {
    ... on ArticleCreateOk {
      article {
        id
        content
        createdAt
        commentPermission
      }
    }
    ... on ArticleCreateBadRequest {
      message
    }
  }
}
```

### Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸Ğ¹
```yaml
mutation {
  createComment(input: {
    content: "1 ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ",
    articleId:   "fcedfe1c-b1d5-4499-9218-cd32d7f35c43"
      parentId: null
  }) {
    ... on CommentCreateOk {
      comment {
        id
        content
        createdAt
        articleId
        parentId
        replies {
          id
          content
          createdAt
        }
      }
    }
    ... on CommentCreateBadRequest {
      message
    }
  }
}
```

### Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº ÑÑ‚Ğ°Ñ‚ĞµĞ¹
```yaml
query {
  getList(pageNumber: 1, pageSize: 10) {
    ... on ListArticleGetOk {
      articles {
        id
        content
        createdAt
        commentPermission
      }
      total
    }
    ... on ListArticleGetBadRequest {
      message
    }
  }
}
```

### Ğ¡Ñ‚Ğ°Ñ‚ÑŒÑ Ñ ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸ĞµĞ¼
```yaml
query {
  getArticle(
    articleId: "fcedfe1c-b1d5-4499-9218-cd32d7f35c43"
    commentPage: 1
    commentPageSize: 20
  ) {
    ... on ArticleGetOK {
      article {
        id
        content
        createdAt
        commentPermission
      }
      comments {
        id
        content
        createdAt
        replies {
          id
          content
          createdAt
          replies {
            id
            content
            createdAt
            replies {
              id
              content
              createdAt
              replies {
            id
            content
            createdAt
            replies {
              id
              content
              createdAt
            }
          }
            }
          }
        }
      }
    }
    ... on ArticleGetBadRequest {
      message
    }
  }
}
```

## Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ°

```yaml
ğŸ“„ README.md
ğŸ’» cmd
  â””â”€â”€ main.go
âš™ï¸ config.yaml
ğŸ³ Dockerfile
ğŸ“¦ go.mod
ğŸ” go.sum
ğŸ”§ gqlgen.yml
ğŸ§© graph
  â”œâ”€â”€ ğŸ§  model
  â”‚   â””â”€â”€ model.go
  â”œâ”€â”€ ğŸ”„ resolver
  â”‚   â”œâ”€â”€ articlemutation_create.resolvers.go
  â”‚   â”œâ”€â”€ articlequery_get.resolvers.go
  â”‚   â”œâ”€â”€ commentmutation_create.resolvers.go
  â”‚   â”œâ”€â”€ listarticlequery_get.resolvers.go
  â”‚   â””â”€â”€ resolver.go
  â”œâ”€â”€ â³ runtime
  â”‚   â””â”€â”€ runtime.go
  â””â”€â”€ ğŸ“œ schema
      â”œâ”€â”€ ğŸ“ models
      â”‚   â”œâ”€â”€ article.graphql
      â”‚   â””â”€â”€ comment.graphql
      â”œâ”€â”€ ğŸ”¨ mutation
      â”‚   â”œâ”€â”€ article
      â”‚   â”‚   â””â”€â”€ articlemutation_create.graphql
      â”‚   â””â”€â”€ comment
      â”‚       â””â”€â”€ commentmutation_create.graphql
      â”œâ”€â”€ ğŸ” query
      â”‚   â””â”€â”€ article
      â”‚       â”œâ”€â”€ articlequery_get.graphql
      â”‚       â””â”€â”€ listarticlequery_get.graphql
      â””â”€â”€ scalar.graphql
ğŸ› ï¸ internal
  â”œâ”€â”€ âš™ï¸ config
  â”‚   â””â”€â”€ config.go
  â”œâ”€â”€ ğŸ·ï¸ domain
  â”‚   â””â”€â”€ models.go
  â”œâ”€â”€ ğŸ“ logger
  â”‚   â””â”€â”€ logger.go
  â”œâ”€â”€ ğŸ”„ mappers
  â”‚   â””â”€â”€ resolver_mappers.go
  â”œâ”€â”€ ğŸ—„ï¸ repository
  â”‚   â”œâ”€â”€ ğŸ§  inmemory
  â”‚   â”‚   â””â”€â”€ inmemory_repository.go
  â”‚   â”œâ”€â”€ ğŸ­ mocks
  â”‚   â”‚   â””â”€â”€ repository_mock.go
  â”‚   â”œâ”€â”€ ğŸ˜ postgres
  â”‚   â”‚   â”œâ”€â”€ postgres_mappers.go
  â”‚   â”‚   â”œâ”€â”€ postgres_models.go
  â”‚   â”‚   â””â”€â”€ postgres_repository.go
  â”‚   â”œâ”€â”€ repository.go
  â”‚   â””â”€â”€ repository_test.go
  â””â”€â”€ ğŸš€ service
      â”œâ”€â”€ article_service.go
      â”œâ”€â”€ ğŸ­ mocks
      â”‚   â””â”€â”€ service_mock.go
      â”œâ”€â”€ service.go
      â””â”€â”€ service_test.go

```
